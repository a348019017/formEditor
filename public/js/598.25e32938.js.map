{"version":3,"file":"js/598.25e32938.js","mappings":"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","sources":["webpack://pmap-cesium/./src/views/Configforms.vue","webpack://pmap-cesium/src/views/Configforms.vue","webpack://pmap-cesium/./src/views/Configforms.vue?fd1e","webpack://pmap-cesium/./src/views/Configforms.vue?cfa8"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"popuBox\"},[_c('div',{staticStyle:{\"height\":\"100%\",\"width\":\"90%\",\"padding\":\"45px 15px\"}},[_c('el-collapse',{on:{\"change\":_vm.handleChange},model:{value:(_vm.activeNames),callback:function ($$v) {_vm.activeNames=$$v},expression:\"activeNames\"}},_vm._l((_vm.forms),function(item){return _c('el-collapse-item',{key:item.guid,attrs:{\"title\":item.FormTemplate.title,\"name\":item.FormTemplate.name}},[_c('VueForm',{ref:\"form\",refInFor:true,attrs:{\"schema\":item.FormTemplate.template,\"formProps\":{labelPosition:'left'},\"formFooter\":{okBtn:'提交',cancelBtn:'取消'}},on:{\"on-cancel\":_vm.onCancel},model:{value:(item.data),callback:function ($$v) {_vm.$set(item, \"data\", $$v)},expression:\"item.data\"}})],1)}),1)],1),_c('div',[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.onSubmit}},[_vm._v(\"提交\")])],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"popuBox\">     \r\n        <div style=\"height: 100%; width: 90%; padding: 45px 15px\">\r\n            <el-collapse  v-model=\"activeNames\" @change=\"handleChange\">\r\n                <el-collapse-item :key=\"item.guid\" v-for=\"item in forms\" :title=\"item.FormTemplate.title\" :name=\"item.FormTemplate.name\">\r\n                    <VueForm ref=\"form\" v-model=\"item.data\"  :schema=\"item.FormTemplate.template\" @on-cancel=\"onCancel\"  :formProps=\"{labelPosition:'left'}\" :formFooter=\"{okBtn:'提交',cancelBtn:'取消'}\">\r\n                    </VueForm>\r\n                </el-collapse-item>\r\n            </el-collapse>\r\n        </div>\r\n    <div>\r\n        <el-button type=\"primary\" @click=\"onSubmit\">提交</el-button>\r\n    </div>\r\n    </div>\r\n</template>\r\n\r\n<style scoped>\r\n.popuBox  {\r\n  color: rgb(0, 150, 255);\r\n}\r\n</style>\r\n\r\n\r\n<style >\r\n\r\n.el-form-item__content{\r\n    margin-left: 40%;\r\n}\r\n.formFooter_item{\r\n    display: none;\r\n}\r\n\r\n</style>\r\n\r\n<script>\r\nimport VueForm from '@lljj/vue-json-schema-form';\r\nimport {getForms,getformstemplatebygroup,GUID} from \"../api/forms\";\r\nimport {savelocalforms,submitForm,removelocalforms} from \"../api/forms\"\r\nimport { Notify } from 'vant';\r\n//可配置化表单组件，采用vuejsonschemaforms组件实现jsonschema,这里UI采用内置的elementui，兼容移动UI\r\n//扩展折叠UI，以支持多组schema\r\nexport default {\r\n    name:\"ConfigForms\",\r\n    components:{VueForm},\r\n    inject: [\"eventHub\"],\r\n    data() {\r\n        return {\r\n            //是否已经提交过，如果是提交状态，将不再进行缓存。\r\n            ispushed:false,\r\n            showforms: true,\r\n            activeNames:\"\",\r\n            //默认值，创建新表单时会使用\r\n            defaultValues:{},\r\n            forms:[\r\n                {\r\n                    name:\"测试form1\",\r\n                    guid:\"baca1\",\r\n                    data: {},\r\n                    FormTemplate: {\r\n                        type: 'object',\r\n                        required: [\r\n                            'userName',\r\n                            'age',\r\n                        ],\r\n                        properties: {\r\n                            userName: {\r\n                                type: 'string',\r\n                                title: '用户名',\r\n                                default: 'Liu.Jun',\r\n                            },\r\n                            age: {\r\n                                type: 'number',\r\n                                title: '年龄'\r\n                            },\r\n                            bio: {\r\n                                type: 'string',\r\n                                title: '签名',\r\n                                minLength: 10,\r\n                                default: '知道的越多、就知道的越少',\r\n                                'ui:options': {\r\n                                    placeholder: '请输入你的签名',\r\n                                    type: 'textarea',\r\n                                    rows: 1\r\n                                }\r\n                            },\r\n                            imgUrlList: {\r\n                                title: \"图片上传\",\r\n                                type: \"array\",\r\n                                \"ui:widget\": \"UploadWidget\",\r\n                                //action指定上传的接口\r\n                                \"ui:action\": \"https://run.mocky.io/v3/78638190-1adb-4d32-8f6e-400068ffe286\",\r\n                                \"default\": [\r\n                                ],\r\n                                \"items\": {\r\n                                    \"type\": \"string\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    uiSchema: {},\r\n                }\r\n            ],\r\n        }\r\n    },\r\n    mounted(){\r\n        //调用此接口进行交互\r\n        window.onSubmit=this.onSubmit.bind(this);\r\n        this.eventHub.$on(\"clickformedit\", this.onclick);\r\n        //获取router的参数group来获取一组表单\r\n        let group = this.$route.params.group;\r\n        let that=this;\r\n        if (group) {\r\n            getForms(1, 10, group).then(dt => {\r\n                \r\n                if (dt.isok) {\r\n                    if (dt.data && dt.data.length) {\r\n                        this.forms = dt.data;\r\n                        //默认展示第一张表单\r\n                        if (this.forms && this.forms.length > 0) {\r\n                            that.activeNames = this.forms[0].FormTemplate.name;\r\n                        }\r\n                    } else {\r\n                        throw \"no data\"\r\n                    }\r\n\r\n                } else {\r\n                    throw \"no data\"\r\n                }\r\n            })\r\n            .catch(err=>{\r\n                \r\n                that.getTemplate();\r\n            })\r\n            window.formguid=group;\r\n            return;\r\n        }\r\n       \r\n    },\r\n    methods:{\r\n        //没有查询到数据的情况下，需要查询模板，相当于联合了显示和新建功能\r\n        getTemplate() {\r\n            let that=this;\r\n            //获取模板名称\r\n            let tgroup = this.$route.query.group;\r\n            if (tgroup) {\r\n                getformstemplatebygroup(tgroup).then(dt => {\r\n                    if (dt.isok) {\r\n                        //创建一个group用的guid\r\n                        if (!window.formguid) {\r\n                            let groupguid = GUID();\r\n                            window.formguid = groupguid;\r\n                        }\r\n                        this.forms = dt.data.map(i => {\r\n                            let df=that.setDefaultValue(i.template.properties);\r\n                            return {\r\n                                FormTemplate: i,\r\n                                data: df,\r\n                                name: GUID(),\r\n                                group: window.formguid,\r\n                                FormTemplateId: i.id,\r\n                            }\r\n                        });\r\n                        if (this.forms && this.forms.length > 0) {\r\n                            that.activeNames = this.forms[0].FormTemplate.name;\r\n                        }\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        //设置默认的值，根据模板已有的字段进行赋值\r\n        setDefaultValue(template){\r\n            let value={};\r\n            if(!window.android.getSpotInterpretationInfo)\r\n            {\r\n                alert(\"未查找到getSpotInterpretationInfo方法\")\r\n            }\r\n            let df=window.android.getSpotInterpretationInfo();\r\n            df= typeof(df)=='string' ?JSON.parse(df):df;\r\n            Object.keys(template).forEach(i=>{\r\n                if (df[i]) {\r\n                    value[i] = df[i];\r\n                }\r\n            })\r\n            return value;              \r\n        },\r\n        handleChange(){\r\n\r\n        },\r\n        onCancel(){\r\n            this.eventHub.$emit(\"clickform\",true);\r\n        },\r\n        onSubmit(){\r\n            let isValidall = true;\r\n            let allvalidate = this.$refs.form.forEach(i => {\r\n                 i.$refs.genEditForm.validate((isValid, resData) => {\r\n                    isValidall = isValidall && isValid\r\n                });\r\n            })\r\n            if (!isValidall) {\r\n                Notify({ type: 'primary', message: '请补充表单！' });\r\n                return;\r\n            }\r\n            //如果有自定义的保存，手动额外保存一份\r\n            if(window.android.submitResultInfo)\r\n            {\r\n                let total=this.forms.map(i=>i.data);\r\n                total= Object.assign({},...total)\r\n                window.android.submitResultInfo(total);\r\n            }\r\n            //经过验证后方可提交\r\n            submitForm(this.forms).then(dt=>{\r\n                if(dt.isok)\r\n                {\r\n                    Notify({ type: 'primary', message: '提交成功！' });\r\n                    //提交成功后移除此条数据\r\n                    removelocalforms(this.formData).then(isok=>{\r\n                        this.eventHub.$emit(\"clickform\",true);\r\n                    })\r\n                }else\r\n                {\r\n                    Notify({ type: 'primary', message: '提交失败！' });\r\n                }\r\n            })\r\n        },\r\n        //关闭后返回到列表\r\n        handlecloseicon(){\r\n            this.eventHub.$emit(\"clickform\",true);\r\n        },\r\n        //将一些操作封装到其内部，tools采用Eventhub和其子组件通讯,所有toolbar均采用此方式\r\n        onclick(item){\r\n            this.showforms = !this.showforms;\r\n            if (item) {\r\n                this.formData = item;\r\n            }\r\n        }\r\n    },\r\n    watch:{\r\n         //监控数据发生变化时自动保存到localstorage中，下次打开app将自动读取,\r\n        'formData': {\r\n            handler: function (newval, oldval) {\r\n                //默认采用localstorage\r\n                //savelocalforms(newval);\r\n            },\r\n            deep:true\r\n        }\r\n    },\r\n    beforeDestroy(){\r\n        this.eventHub.$off(\"clickformedit\",this.onclick);\r\n    }\r\n}\r\n</script>\r\n","import mod from \"-!../../node_modules/_thread-loader@3.0.4@thread-loader/dist/cjs.js!../../node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js??vue-loader-options!./Configforms.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/_thread-loader@3.0.4@thread-loader/dist/cjs.js!../../node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js??vue-loader-options!./Configforms.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Configforms.vue?vue&type=template&id=9ab47884&scoped=true&\"\nimport script from \"./Configforms.vue?vue&type=script&lang=js&\"\nexport * from \"./Configforms.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Configforms.vue?vue&type=style&index=0&id=9ab47884&prod&scoped=true&lang=css&\"\nimport style1 from \"./Configforms.vue?vue&type=style&index=1&id=9ab47884&prod&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/_vue-loader@15.10.0@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"9ab47884\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","staticStyle","on","handleChange","model","value","activeNames","callback","$$v","expression","_l","forms","item","key","guid","attrs","FormTemplate","title","name","ref","refInFor","template","labelPosition","okBtn","cancelBtn","onCancel","data","$set","onSubmit","_v","staticRenderFns","components","VueForm","inject","ispushed","showforms","defaultValues","type","required","properties","userName","default","age","bio","minLength","placeholder","rows","imgUrlList","uiSchema","mounted","window","getForms","that","catch","err","methods","getTemplate","getformstemplatebygroup","group","FormTemplateId","setDefaultValue","alert","df","Object","i","isValidall","total","submitForm","Notify","message","removelocalforms","handlecloseicon","onclick","watch","handler","deep","beforeDestroy","component"],"sourceRoot":""}